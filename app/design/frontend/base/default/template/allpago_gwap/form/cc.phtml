<script type="text/javascript">    //<![CDATA[    /*   Masked Input plugin for jQuery   Copyright (c) 2007-2011 Josh Bush (digitalbush.com)   Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)   Version: 1.3     */    <?php if(Mage::getStoreConfig('payment/gwap_cc/api_mascara')): ?>        (function(e){function t(){var e=document.createElement("input"),t="onpaste";return e.setAttribute(t,""),"function"==typeof e[t]?"paste":"input"}var n,a=t()+".mask",r=navigator.userAgent,i=/iphone/i.test(r),o=/android/i.test(r);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,r){var c,l,s,u,f,h;return!t&&this.length>0?(c=e(this[0]),c.data(e.mask.dataName)()):(r=e.extend({placeholder:e.mask.placeholder,completed:null},r),l=e.mask.definitions,s=[],u=h=t.length,f=null,e.each(t.split(""),function(e,t){"?"==t?(h--,u=e):l[t]?(s.push(RegExp(l[t])),null===f&&(f=s.length-1)):s.push(null)}),this.trigger("unmask").each(function(){function c(e){for(;h>++e&&!s[e];);return e}function d(e){for(;--e>=0&&!s[e];);return e}function m(e,t){var n,a;if(!(0>e)){for(n=e,a=c(t);h>n;n++)if(s[n]){if(!(h>a&&s[n].test(R[a])))break;R[n]=R[a],R[a]=r.placeholder,a=c(a)}b(),x.caret(Math.max(f,e))}}function p(e){var t,n,a,i;for(t=e,n=r.placeholder;h>t;t++)if(s[t]){if(a=c(t),i=R[t],R[t]=n,!(h>a&&s[a].test(i)))break;n=i}}function g(e){var t,n,a,r=e.which;8===r||46===r||i&&127===r?(t=x.caret(),n=t.begin,a=t.end,0===a-n&&(n=46!==r?d(n):a=c(n-1),a=46===r?c(a):a),k(n,a),m(n,a-1),e.preventDefault()):27==r&&(x.val(S),x.caret(0,y()),e.preventDefault())}function v(t){var n,a,i,l=t.which,u=x.caret();t.ctrlKey||t.altKey||t.metaKey||32>l||l&&(0!==u.end-u.begin&&(k(u.begin,u.end),m(u.begin,u.end-1)),n=c(u.begin-1),h>n&&(a=String.fromCharCode(l),s[n].test(a)&&(p(n),R[n]=a,b(),i=c(n),o?setTimeout(e.proxy(e.fn.caret,x,i),0):x.caret(i),r.completed&&i>=h&&r.completed.call(x))),t.preventDefault())}function k(e,t){var n;for(n=e;t>n&&h>n;n++)s[n]&&(R[n]=r.placeholder)}function b(){x.val(R.join(""))}function y(e){var t,n,a=x.val(),i=-1;for(t=0,pos=0;h>t;t++)if(s[t]){for(R[t]=r.placeholder;pos++<a.length;)if(n=a.charAt(pos-1),s[t].test(n)){R[t]=n,i=t;break}if(pos>a.length)break}else R[t]===a.charAt(pos)&&t!==u&&(pos++,i=t);return e?b():u>i+1?(x.val(""),k(0,h)):(b(),x.val(x.val().substring(0,i+1))),u?t:f}var x=e(this),R=e.map(t.split(""),function(e){return"?"!=e?l[e]?r.placeholder:e:void 0}),S=x.val();x.data(e.mask.dataName,function(){return e.map(R,function(e,t){return s[t]&&e!=r.placeholder?e:null}).join("")}),x.attr("readonly")||x.one("unmask",function(){x.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){clearTimeout(n);var e;S=x.val(),e=y(),n=setTimeout(function(){b(),e==t.length?x.caret(0,e):x.caret(e)},10)}).bind("blur.mask",function(){y(),x.val()!=S&&x.change()}).bind("keydown.mask",g).bind("keypress.mask",v).bind(a,function(){setTimeout(function(){var e=y(!0);x.caret(e),r.completed&&e==x.val().length&&r.completed.call(x)},0)}),y()}))}})})(jQuery);    <?php endif; ?>        jQuery(document).ready(function(){                //jQuery('#gwap_cc_cc_number').mask("9999-9999-9999-9999");        //jQuery('#gwap_cc_cc_cid').mask("999");        jQuery('#gwap_cc_cc_number').mask("9999-9999-9999-99?99");        jQuery('#gwap_cc_cc_cid').mask("999?9");                        jQuery('#gwap_cc_cc_number').keyup(function(){                        if (jQuery('#gwap_cc_cc_number').val()[0] == 4){                jQuery('#gwap_cc_cc_type_VISA').click();                               } else if( jQuery('#gwap_cc_cc_number').val()[0] == 5 ) {                jQuery('#gwap_cc_cc_type_MASTER').click();                            } else if( ['30', '36', '38'].indexOf(jQuery('#gwap_cc_cc_number').val()[0]+jQuery('#gwap_cc_cc_number').val()[1]) >= 0) {                jQuery('#gwap_cc_cc_type_DINERS').click();            } else if( ['34', '37'].indexOf(jQuery('#gwap_cc_cc_number').val()[0]+jQuery('#gwap_cc_cc_number').val()[1]) >= 0) {                jQuery('#gwap_cc_cc_type_AMEX').click();            } else if( ['6'].indexOf(jQuery('#gwap_cc_cc_number').val()[0]+jQuery('#gwap_cc_cc_number').val()[1]) >= 0) {                jQuery('#gwap_cc_cc_type_ELO').click();                            } else {                jQuery('.payment-option-gwap_cc').removeClass('selected');            }        })    }); //]]></script><?php // Trazer maior parcela entre os produtos do carrinho//    $parcela_maxima = $this->getParcelaMaxima();//    $parcelaHtml = $this->getLayout()->createBlock('installments/form');//    if ($parcela_maxima > 0){//        $parcelaHtml->setMaxInstallment($parcela_maxima)->setHasInstallment(true);//    }//    //    echo $parcelaHtml->setPaymentFormBlock($this)//                     ->setPaymentInstallmentCode('cc_parcelas')//                     ->setPaymentCode($_code)//                     ->toHtml();       ?><?php $_code = $this->getMethodCode() ; ?><ul class="form-list" id="payment_form_<?php echo $_code ?>" style="display:none;">            <li>            <div class="input-box">                <ul>                <?php foreach ($this->getCcAvailableTypes() as $_typeCode => $_typeName): ?>                        <li style="display:inline-table; margin:5px 0px 0px 5px">                             <div class="payment-option-<?php echo $_code ?> <?php if( $this->htmlEscape($this->getInfoData('cc_type') ) == $_typeCode ) echo 'selected'; ?>">                                <input id="<?php echo $_code ?>_cc_type_<?php echo $_typeCode ?>" value="<?php echo $_typeCode ?>" class="validate-one-required-by-name" name="payment[<?php echo $_code ?>_cc_type]" type="radio" <?php if( $this->htmlEscape($this->getInfoData('cc_type') ) == $_typeCode ) echo 'checked'; ?> >                                <label for="<?php echo $_code ?>_cc_type_<?php echo $_typeCode ?>">                                    <img src="<?php echo $this->getSkinUrl("images/allpago_gwap/cards/ico_{$_typeCode}.png"); ?>" alt="<?php echo $_typeName ?>" title="<?php echo $_typeName ?>" class="gwapico" hspace="8"/>                                </label>                            </div>                        </li>                <?php endforeach; ?>                </ul>            </div>        </li>                <li>            <div class="input-box">                <label for="<?php echo $_code ?>_cc_owner" class="required"><em>*</em><?php echo Mage::helper('gwap')->__('Name on Card') ?></label>                <input type="text" title="<?php echo Mage::helper('gwap')->__('Name on Card') ?>" class="input-text required-entry" id="<?php echo $_code ?>_cc_owner" name="payment[<?php echo $_code ?>_cc_owner]" value="<?php echo $this->htmlEscape($this->getInfoData('cc_owner')) ?>" />            </div>        </li>        <li>            <label for="<?php echo $_code ?>_cc_number" class="required"><em>*</em><?php echo Mage::helper('gwap')->__('Credit Card Number') ?></label>            <div class="input-box">                <input type="text" id="<?php echo $_code ?>_cc_number" name="payment[<?php echo $_code ?>_cc_number]" title="<?php echo Mage::helper('gwap')->__('Credit Card Number') ?>" class="input-text validate-cc-number validate-cc-type required-entry" value="" />            </div>        </li>        <li id="<?php echo $_code ?>_cc_type_exp_div">            <label for="<?php echo $_code ?>_expiration" class="required"><em>*</em><?php echo Mage::helper('gwap')->__('Expiration Date') ?></label>            <div class="input-box">                <div class="v-fix">                    <select id="<?php echo $_code ?>_expiration" name="payment[<?php echo $_code ?>_cc_exp_month]" class="month validate-cc-exp required-entry">                        <?php $_ccExpMonth = $this->getInfoData('cc_exp_month') ?>                        <?php foreach ($this->getCcMonths() as $k => $v): ?>                            <option value="<?php echo $k ? $k : '' ?>"<?php if ($k == $_ccExpMonth): ?> selected="selected"<?php endif ?>><?php echo $v ?></option>                        <?php endforeach ?>                    </select>                </div>                <div class="v-fix">                    <?php $_ccExpYear = $this->getInfoData('cc_exp_year') ?>                    <select id="<?php echo $_code ?>_expiration_yr" name="payment[<?php echo $_code ?>_cc_exp_year]" class="year required-entry">                        <?php foreach ($this->getCcYears() as $k => $v): ?>                            <option value="<?php echo $k ? $k : '' ?>"<?php if ($k == $_ccExpYear): ?> selected="selected"<?php endif ?>><?php echo $v ?></option>                        <?php endforeach ?>                    </select>                </div>            </div>        </li>        <?php echo $this->getChildHtml() ?>        <?php if ($this->hasVerification()): ?>            <li id="<?php echo $_code ?>_cc_type_cvv_div">                <label for="<?php echo $_code ?>_cc_cid" class="required"><em>*</em><?php echo Mage::helper('gwap')->__('Card Verification Number') ?></label>                <div class="input-box">                    <div class="v-fix">                        <input style="width: 43px!important;" type="text" title="<?php echo Mage::helper('gwap')->__('Card Verification Number') ?>" class="input-text cvv validate-cc-cvn required-entry" id="<?php echo $_code ?>_cc_cid" name="payment[<?php echo $_code ?>_cc_cid]" value="" maxlength="4" />                    </div>                    <a href="#" class="cvv-what-is-this"><?php echo Mage::helper('gwap')->__('What is this?') ?></a>                </div>            </li>        <?php endif; ?>                            <?php if ($this->hasSsCardType()): ?>            <li id="<?php echo $_code ?>_cc_type_ss_div">                <ul class="inner-form">                    <li class="form-alt"><label for="<?php echo $_code ?>_cc_issue" class="required"><em>*</em><?php echo Mage::helper('gwap')->__('Switch/Solo/Maestro Only') ?></label></li>                    <li>                        <label for="<?php echo $_code ?>_cc_issue"><?php echo Mage::helper('gwap')->__('Issue Number') ?>:</label>                        <span class="input-box">                            <input type="text" title="<?php echo Mage::helper('gwap')->__('Issue Number') ?>" class="input-text validate-cc-ukss cvv" id="<?php echo $_code ?>_cc_issue" name="payment[<?php echo $_code ?>_cc_ss_issue]" value="" />                        </span>                    </li>                    <li>                        <label for="<?php echo $_code ?>_start_month"><?php echo Mage::helper('gwap')->__('Start Date') ?>:</label>                        <div class="input-box">                            <div class="v-fix">                                <select id="<?php echo $_code ?>_start_month" name="payment[cc_ss_start_month]" class="validate-cc-ukss month">                                    <?php foreach ($this->getCcMonths() as $k => $v): ?>                                        <option value="<?php echo $k ? $k : '' ?>"<?php if ($k == $this->getInfoData('cc_ss_start_month')): ?> selected="selected"<?php endif ?>><?php echo $v ?></option>                                    <?php endforeach ?>                                </select>                            </div>                            <div class="v-fix">                                <select id="<?php echo $_code ?>_start_year" name="payment[cc_ss_start_year]" class="validate-cc-ukss year">                                    <?php foreach ($this->getSsStartYears() as $k => $v): ?>                                        <option value="<?php echo $k ? $k : '' ?>"<?php if ($k == $this->getInfoData('cc_ss_start_year')): ?> selected="selected"<?php endif ?>><?php echo $v ?></option>                                    <?php endforeach ?>                                </select>                            </div>                        </div>                    </li>                    <li class="adv-container">&nbsp;</li>                </ul>                <?php /*                <script type="text/javascript">                    //<![CDATA[                    var SSChecked<?php echo $_code ?> = function() {                        var elm = $('<?php echo $_code ?>_cc_type');                        if (['SS','SM','SO'].indexOf(elm.value) != -1) {                            $('<?php echo $_code ?>_cc_type_ss_div').show();                        } else {                            $('<?php echo $_code ?>_cc_type_ss_div').hide();                        }                    };                    Event.observe($('<?php echo $_code ?>_cc_type'), 'change', SSChecked<?php echo $_code ?>);                    SSChecked<?php echo $_code ?>();                    //]]>                </script>                 *                  */ ?>            </li>        <?php endif; ?></ul><script type="text/javascript">    //<![CDATA[        payment_elements = $$('div.payment-option-<?php echo $_code ?>');    if( payment_elements.length > 0 ){        for(i=0;i<payment_elements.length;i++){            payment_elements[i].observe('click', function (){paymentSelected(this, 'div.payment-option-<?php echo $_code ?>')});        }    }    //]]></script>